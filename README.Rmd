---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# basecamper

<!-- badges: start -->
[![Lifecycle: experimental](https://img.shields.io/badge/lifecycle-experimental-orange.svg)](https://www.tidyverse.org/lifecycle/#experimental)
<!-- badges: end -->

The goal of basecamper is to work with Basecamp Classic API to interact with Basecamp directly from R.

What you can do with this package:

  - Query
    - Projects you have privileges to
    - Specific project information
    - Attachments in a project
  - Download attached files in a project
  - Unzip large files (`>4gb`)
  
## Installation

To use this package clone the repository and install locally

## Example

This is a basic example which shows you how to solve a common problem:

```{r example}
library(basecamper)
```

Set up the TOKEN and HOST

You can find your TOKEN by logging into Basecamp

  - Click on `My info` found in the top right corner of the website
  - At the bottom of this page you will see `Authentication tokens`, click on `Show your tokens`
  - Copy the `Token for feed readers or the Basecamp API`, this goes into the `BASECAMP_TOKEN` environment variable.

```{r,eval=FALSE}
Sys.setenv(BASECAMP_TOKEN = 'MYTOKEN')
Sys.setenv(BASECAMP_HOST  = 'https://metrumresearchgroup.basecamphq.com')
```

## Queries

### Projects

```{r}
projects <- basecamper::basecamp_projects()
```

#### Projects methods

```{r}
print(projects)
```

```{r}
summary(projects)
```

### Project

```{r}
(TAKEDA_IQVA <- summary(projects)[[19,'id']])
project <- basecamper::basecamp_project(TAKEDA_IQVA)
```

#### Project methods

```{r}
print(project)
```

### Attachments

```{r}
attachments <- basecamper::basecamp_attachment(TAKEDA_IQVA)
```

#### Attachments methods

```{r}
print(attachments)
```

```{r}
summary(attachments)
```

## Download File

```{r}
attach_summary <- summary(attachments)

(file_url  <- attach_summary$url[attach_summary$filesize==min(attach_summary$filesize)])

td <- tempdir()

basecamp_download(file_url,destdir = td)

list.files(td,pattern = '.zip$')

```

## Unzip

`basecamper::unzip2` runs unzip from CLI which is more robust for files larger than `4gb` which are truncated by `utils::zip`

```{r}

basecamper::unzip2(directory = td,
                   file = list.files(td,pattern = '.zip$',full.names = TRUE))

list.files(td,pattern = '.(pdf|xlsx)$')
```
